name: rclone Build

on:
  push:
    branches:
      - feat/rclone-build

jobs:
  build-linux:
    name: Build Linux Binary
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-go@v5
        with:
          go-version: '1.22'

      - name: Build Linux Binary
        run: make build-linux

      - name: Create ~/.zcn and add wallet.json and config.yaml
        run: |
          mkdir -p ~/.zcn
           printf '%s' "${{ secrets.ZCN_WALLET_JSON }}" | base64 -d > ~/.zcn/wallet.json
           printf '%s' "${{ secrets.ZCN_CONFIG_YAML }}" > ~/.zcn/config.yaml

      - name: Setup rclone Configuration
        run: |
          mkdir -p ~/.config/rclone
          printf '%s' "${{ secrets.RCLONE_CONF }}" > ~/.config/rclone/rclone.conf

      - name: Funcionality Test
        run: |
          # Create a dummy file
          echo "This is a test file for Züs upload." > linux.txt
      
          # Upload the dummy file to Züs
          ./rclone copy linux.txt automation:workflow
      
          # List the uploaded file
          echo "Listing uploaded file:"
          ./rclone lsf automation:workflow
      
          # Verify file exists
          FILE_FOUND=$(./rclone lsf automation:workflow | grep "^linux.txt$" || true)
          if [ -z "$FILE_FOUND" ]; then
            echo "File not found on remote!"
            exit 1
          else
            echo "File verified: $FILE_FOUND"
          fi
      
          # Delete the uploaded file
          ./rclone delete  automation:workflow

      - name: Upload Built Binary
        uses: actions/upload-artifact@v4
        with:
          name: rclone-linux
          path: ./rclone


  # build-windows:
  #   name: Build Windows Binary
  #   runs-on: windows-latest

  #   steps:
  #     - uses: actions/checkout@v4
  #     - uses: actions/setup-go@v5
  #       with:
  #         go-version: '1.22'
  #     - run: make build-windows-native
  #     - uses: actions/upload-artifact@v4
  #       with:
  #         name: rclone-windows
  #         path: ./rclone.exe

  # build-mac-amd:
  #   name: Build macOS (Intel)
  #   runs-on: macos-13

  #   steps:
  #     - uses: actions/checkout@v4
  #     - uses: actions/setup-go@v5
  #       with:
  #         go-version: '1.22'
  #     - run: go clean -cache -modcache -testcache
  #     - run: make build-mac-amd
  #     - uses: actions/upload-artifact@v4
  #       with:
  #         name: rclone-mac-amd64
  #         path: ./rclone

  # build-mac-arm:
  #   name: Build macOS (Apple Silicon)
  #   runs-on: macos-14

  #   steps:
  #     - uses: actions/checkout@v4
  #     - uses: actions/setup-go@v5
  #       with:
  #         go-version: '1.22'
  #     - run: go clean -cache -modcache -testcache
  #     - run: make build-mac-arm
  #     - uses: actions/upload-artifact@v4
  #       with:
  #         name: rclone-mac-arm64
  #         path: ./rclone
